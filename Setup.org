* TODO Introduction
* TODO Execution
** TODO Bootstrap shell script before git
** TODO SSH key generation and management
** TODO Secret managment
Maybe have an encrypted vault in here
** TODO commit hooks to tangle this

* Modules
** DONE git
On macos I'm currently installing git from xcode tools using `xcode-select --install` currently, I then use git to fetch this repository, and so it needs to be done as a previous step, a preliminary setup script would be able to do this part to though.

#+BEGIN_SRC shell :tangle git/install@Linux.sh :shebang "#!/bin/bash"
sudo apt-get install -y git
#+END_SRC

The git config dotfile.

#+BEGIN_SRC config :tangle git/gitconfig.symlink
[user]
	name = Mike Bush
	email = mpbush@gmail.com
[core]
	autocrlf = input
	excludesfile = ~/.gitignore_global
[push]
	default = simple
[alias]
	undo-commit = reset --soft HEAD~1
	redo-commit = commit -c ORIG_HEAD
[url "git@github.com:"]
	insteadOf = https://github.com/
[url "git@prod01-gitlab01.geeny.local:"]
	insteadOf = https://prod01-gitlab01.geeny.local/
#+END_SRC

Git ignore for system and editor temp files.
#+BEGIN_SRC config :tangle git/gitignore_global.symlink
.DS_Store
*~
*.swp
.#*
#+END_SRC

Small alias for quick status checking.

#+BEGIN_SRC shell :tangle git/alias.bash
alias gs="git status -s"
#+END_SRC

** DONE asdf
asdf is a version manager for a variety of development tools listed below.
#+BEGIN_SRC shell
asdf plugin-list-all
#+END_SRC

#+RESULTS:
| R          |
| adr-tools  |
| bazel      |
| clojure    |
| consul     |
| crystal    |
| dmd        |
| elixir     |
| elm        |
| erlang     |
| golang     |
| gradle     |
| haskell    |
| idris      |
| java       |
| julia      |
| kops       |
| kubecfg    |
| kubectl    |
| lfe        |
| lua        |
| luaJIT     |
| maven      |
| minikube   |
| mongodb    |
| nim        |
| nodejs     |
| nomad      |
| ocaml      |
| openresty  |
| packer     |
| php        |
| postgres   |
| python     |
| racket     |
| rebar      |
| redis      |
| riak       |
| ruby       |
| rust       |
| sbt        |
| scala      |
| serf       |
| solidity   |
| spark      |
| swift      |
| terraform  |
| terragrunt |
| vault      |

It is installed as a git repository in `$HOME/.asdf`. Currently the version is specified in here, and so wont update on rerun.
#+BEGIN_SRC shell :tangle asdf/install.sh :shebang "#! /bin/sh"
ASDF_DIR=$HOME/.asdf
ASDF_BRANCH=v0.4.1
if [ ! -d $ASDF_DIR ]; then # new install
  git clone https://github.com/asdf-vm/asdf.git --branch $ASDF_BRANCH $ASDF_DIR && cd $ASDF_DIR && git checkout $ASDF_BRANCH
else
  cd "$ASDF_DIR" && git pull origin $ASDF_BRANCH
fi
#+END_SRC

It is then sourced in to the shell in the profile
#+BEGIN_SRC shell :tangle asdf/completion.bash
. $HOME/.asdf/asdf.sh
. $HOME/.asdf/completions/asdf.bash
#+END_SRC

** DONE homebrew
Homebrew is a package manager for macos, it enables the installation of many of the modules below on macos.

The installation is a shell script hosted on github, we run it only if homebrew is not found on the path, homebrew updates itself so there is no need to do updates on this run.

#+BEGIN_SRC shell :tangle homebrew@Darwin/install.sh :shebang "#! /bin/sh"
set -e

# Check for Homebrew
if test ! $(which brew)
  then
  echo "  Installing Homebrew for you."
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi
#+END_SRC

The other modules contain .brew files which can be appended together and passed to homebrew as a bundle to install.

#+BEGIN_SRC shell :tangle homebrew@Darwin/install.sh
cd "$(dirname $0)"/..

# find the homebrew bundles and run them all
echo "Installing brew bundles"
cat $(find . -name *.brew) | \
  brew bundle --file=-
#+END_SRC

A couple of the installers require homebrew plus some other stuff, these have shell scripts.

#+BEGIN_SRC shell :tangle homebrew@Darwin/install.sh
# find the homebrew dependent installers and run them iteratively
find . -name homebrew.install.sh \
  | while read installer; do
      echo "installing ${installer}"
      sh -c "${installer}"
      echo "installed ${installer}"
  done


exit 0
#+END_SRC

We have a bunch of homebrew packages which I haven't yet bothered to separate into their own modules.
#+BEGIN_SRC homebrew :tangle homebrew@Darwin/misc.brew
tap "d12frosted/emacs-plus"
cask "spectacle"
cask "google-chrome"
cask "spotify"
cask "enpass"
brew "httpie"
brew "jq"
brew "tree"
brew "d12frosted/emacs-plus/emacs-plus"
cask "slack"
cask "pritunl"
cask "firefox"
#+END_SRC

** DONE docker
Docker is installed using homebrew.

#+BEGIN_SRC brewfile :tangle docker/docker.brew
cask "docker"
#+END_SRC

Aliases for common things that are easy to make typos
#+BEGIN_SRC shell :tangle docker/alias.bash
alias dk=docker
alias dm=docker-machine
alias dc=docker-compose
alias dkpeek="docker run --rm -it"
#+END_SRC

** TODO node
** TODO Neovim
** TODO Spacemacs
** TODO Wireshark
** TODO SSH
Some of the ssh config I would like to live in here, some of it I would not

SSH remote profiles
