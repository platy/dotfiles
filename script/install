#!/bin/sh
#
# Run all dotfiles installers.

set -e

cd "$(dirname $0)"/..

echo Running system specific installer first
. script/install@Darwin

echo Install ASDF version manager
ASDF_DIR=$HOME/.asdf
ASDF_BRANCH=v0.4.1
if [ ! -d $ASDF_DIR ]; then # new install
  git clone https://github.com/asdf-vm/asdf.git --branch $ASDF_BRANCH $ASDF_DIR && cd $ASDF_DIR && git checkout $ASDF_BRANCH
else
  cd "$ASDF_DIR" && git pull origin $ASDF_BRANCH
fi

echo "Installing brew bundles"
brew bundle --file=$DOTFILES/gen/Brewfile

# find the homebrew dependent installers and run them iteratively
find $DOTFILES -name homebrew.install.sh \
  | while read installer; do
      echo "installing ${installer}"
      sh -c "${installer}"
      echo "installed ${installer}"
  done

exit 0

echo Install default Spacemacs configurations
if [ ! -d ~/.emacs.d ]; then # new install
  git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d
else
  cd ~/.emacs.d && git pull
fi
